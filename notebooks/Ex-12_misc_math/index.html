

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Other operations on functions in the MW basis</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_lesson.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/minipres.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Bibliography" href="../../zbibliography/" />
    <link rel="prev" title="Derivative operators" href="../Ex-10_derivatives/" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search/"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/hylleraas-logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/hylleraas-logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../">
                    Multiwavelet tutorial
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../setup/">Setting up your system</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Exercises</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Ex-1_vampyr_intro/">VAMPyR introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Ex-2_Ex-3_display_MW_scaling_wavelet/">Wavelet example: Haar</a></li>

<li class="toctree-l1"><a class="reference internal" href="../Ex-4_MW-filters/">Switching Representations via Two-Scale Relations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Ex-6_function_proejction_1d/">Function projection in a MW basis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Ex-7_3d-grid/">Extension to many dimensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Ex-8_separated_representation/">Separated representations of integral kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Ex-9_Poisson_Helmholtz/">Application of Poisson and Helmholtz operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Ex-10_derivatives/">Derivative operators</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Other operations on functions in the MW basis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../zbibliography/">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/MRChemSoft/math-tutorial-NMQC/master?urlpath=lab/tree/content/notebooks/Ex-12_misc_math.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/MRChemSoft/math-tutorial-NMQC" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/MRChemSoft/math-tutorial-NMQC/edit/master/content/notebooks/Ex-12_misc_math.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/MRChemSoft/math-tutorial-NMQC/issues/new?title=Issue%20on%20page%20%2Fnotebooks/Ex-12_misc_math.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/Ex-12_misc_math.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Other operations on functions in the MW basis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="other-operations-on-functions-in-the-mw-basis">
<h1>Other operations on functions in the MW basis<a class="headerlink" href="#other-operations-on-functions-in-the-mw-basis" title="Permalink to this heading">#</a></h1>
<p>As already described, we have two complementary representations of functions</p>
<ul class="simple">
<li><p>Reconstructed:
$<span class="math notranslate nohighlight">\(f(x) = \sum_l \sum_i s^{N_{max}+1}_{il} \phi^n_{il}(x)\)</span>$</p></li>
<li><p>Compressed:
$<span class="math notranslate nohighlight">\(f(x) = \sum_i s^{N_0}_i \phi^0_i(x) + \sum_{n=N_{min}}^{N_{max}} \sum_l \sum_i d^n_{il} \psi^n_{il}(x)\)</span>$</p></li>
</ul>
<p>There is a third representation, which is the value of the function tabluated at the Gauss-Legendre quadrature points. Transforming from the scaling function coefficients to the function values is fast and accurate. Note that if instead of using Legendre polynomials as the scaling functions one picked the interpolating polynomials, then the scaling function coefficients would be the function values.</p>
<p>When applying an operator to a function one picks the most efficient/convenient representation.  Note that the fast wavelet transform plays exactly the same role as does the fast Fourier transform does in plane wave calculations in which you switch between a real-space grid of function values and a Fourier-space grid of plane-wave coefficients.</p>
<ul class="simple">
<li><p>In plane-wave calculations some operators are diagonal in real space (e.g., multiplication of functions) or diagonal in Fourier space (e.g., differentiation, application of the Coulomb Green’s function).  But the price is that the basis is global and there is no adaptive refinement.</p></li>
<li><p>In the wavelet basis, some operators are nearly-diagonal in real space (e.g., differentiation, multiplication) or nearly diagonal in wavelet space (e.g., application of the Coulomb Green’s function).  The benefit from this tradeoff is adaptive refinement.</p></li>
</ul>
<p><em>Scaling by a constant:</em> In any representation, just scale the coefficients/values.</p>
<p><em>Addition and substraction of functions:</em>  This can be peformed in any of the representations, with some clean up afterwards.</p>
<ul class="simple">
<li><p>In the wavelet basis, one simply adds coefficients.  This is because the wavelet functions are orthogonal both within and between scales.</p></li>
<li><p>In the scaling function basis and if the two input functions have an identical pattern of adaptive refinement,  one can again just add coefficients.  However, since the scaling functions are only orthogonal within the same scale, if the refinement patterns differ, adding the coefficients will produce a non-standard representation with scaling function coefficients at multiple levels in the tree.  This can be fixed up after the addition by summing the coefficients down the tree using the two-scale relationship.</p></li>
<li><p>The preferred approach depends on the context.  If you are just adding up a bunch of functions to produce a single result, it is fastest to just use the representation you are in and fix up the result as needed.  If performing a linear transformation of a vector of functions, it is perhaps fastest to first transform into the compressed form.</p></li>
<li><p>The result is exact within usual machine round off errors.</p></li>
</ul>
<p><em>Multiplication of functions:</em> This is most readily composed using the function-value representation in which we naively just multiply corresponding function values at the Gauss-Legendre grid points.  However, there are three things that make this more complicated.</p>
<ol class="arabic simple">
<li><p>Adaptive refinement:  If the input functions differ in their refinement levels, one has to use the two-scale relationship to recur the coefficients of the least refined tree down to the level of the more deeply refined tree.  In practice, one walks down the union of the two trees and directly computes the values of the coarser-scale polynomials at the Gauss-Legendre quadrature points at the finer scale.</p></li>
<li><p>Sparsity: Consider multiplying two disjoint functions — i.e., two functions that have no non-zero values in common.  Their product is indentically zero.  However, the algorithm described above would produce a tree that is the union of the inputs.  Similarly, consider multiplying two functions that only have small tails that overlap.  Most of the product might be below the trunction threshold, yet the algorithm will again compute everything.  For thresholding, one first walks up the tree of each function to compute in each box of tree the norm of each input function.  Then the product is computed as described by walking down the union of trees but now with knowledge of the norm of the result so that the traversal can be stopped as appropriate.</p></li>
<li><p>Maintaining accuracy: While it innocently seems as if we are multiplying function values at the quadrature points within each adaptively refined box, what we are really doing is multiplying two polynomials of degree <span class="math notranslate nohighlight">\(k-1\)</span>.  Thus, the exact product is of degree <span class="math notranslate nohighlight">\(2k-2\)</span>.  But we are representing the result in the degree <span class="math notranslate nohighlight">\(k-1\)</span> basis.  I.e., there is a truncation error in the product.  One can estimate this trunction error and refine to compute the product at a lower level as needed.  Beylkin gives a concise argument that you at most need to only refine down one level, assuming that you have already adequately sampled each of the input functions.  Consider multiplying two plane waves <span class="math notranslate nohighlight">\(\exp(i \omega x) * \exp(i \omega x) = \exp(i 2 \omega x)\)</span>, with <span class="math notranslate nohighlight">\(\omega = 2 \pi / h = 2 \pi 2^n / L\)</span> (in which <span class="math notranslate nohighlight">\(h\)</span> is the size of a box at level <span class="math notranslate nohighlight">\(n\)</span> and <span class="math notranslate nohighlight">\(L\)</span> is the overall domain size).  Thus, the product naturally lives one level down.</p></li>
</ol>
<p><em>Non-linear functions of a function:</em> We’ve already looked at multiplication.  Other non-linear unary (e.g., <span class="math notranslate nohighlight">\(\exp(f(x)\)</span> or <span class="math notranslate nohighlight">\(\sqrt{f(x)}\)</span>) and binary (e.g., <span class="math notranslate nohighlight">\(f(x)^{g(x)}\)</span> work similarly, though different analyis is necessary to maintain accuracy.  Some care is needed in handling numerical noise that can take a function outside its anticipated valid range of values.  For instance, consider a density computed as <span class="math notranslate nohighlight">\(\rho(r) = \sum_i \phi_i(r)^2\)</span>.  We expect this to be positive everywhere.  However, due to truncation error, the values could be negative where the function value falls below the truncation threshold. More challenging, when computing <span class="math notranslate nohighlight">\(|\nabla \rho|/\rho\)</span>, as required in GGA DFT functionals, we need to manage possibly uncorrelated numerical noise in both <span class="math notranslate nohighlight">\(|\grad \rho|\)</span> and <span class="math notranslate nohighlight">\(\rho\)</span>.  Instead, one can note that <span class="math notranslate nohighlight">\(|\nabla \rho|/\rho = |\nabla \log \rho|\)</span>, as suggested by Bischoff.  Thus, you can see that some thought and reformulation can be helpful in practice.</p>
<p><strong>Exercise:</strong></p>
<ul class="simple">
<li><p>In 3D, <span class="math notranslate nohighlight">\(f(r,c,a) = (a/\pi)^{3/2} \exp(-a |r-c|^2)\)</span> is a Gaussian centered at <span class="math notranslate nohighlight">\(c\)</span> with exponent <span class="math notranslate nohighlight">\(a\)</span> normalized so its integral is unity.</p></li>
<li><p>The [Gaussian Product Theorem](https://molssi.github.io/MIRP/gaussian_product_theorem.html#:~:text=The%20Gaussian%20Product%20Theorem%20(GPT,quantum%20chemistry%20to%20simplify%20integrals.) tells us that the product of two Gaussians is another Gaussian</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(f(r,c,a) f(r,d,b) =  \exp(ab|c-d|^2 / (a+b))f(r,(ac - bd)/(a+b)) \)</span></p></li>
</ul>
</li>
<li><p>Project two 3D Gaussian test functions with different exponents and centers and also directly project their product.</p></li>
<li><p>Demonstrate that addition of two functions is exact within expected numerical error due to machine precision.</p></li>
<li><p>Explore (using both plots and function norms) as a function of their exponents, centers, and the truncation threshold the errors of the numerically computed product (i.e., compute the product and compare it against the directly computed result) including when the product becomes negligible as the Gaussians barely overlap.</p></li>
</ul>
<p><strong>Exercise:</strong></p>
<ul class="simple">
<li><p>In 1D, project a Gaussian to low precision and examine the nature of the noise and how and where it can be negative, and how this noise changes as you perform operations on the function including truncation.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">vampyr</span> <span class="kn">import</span> <span class="n">vampyr1d</span> <span class="k">as</span> <span class="n">vp1</span>
<span class="kn">from</span> <span class="nn">vampyr</span> <span class="kn">import</span> <span class="n">vampyr2d</span> <span class="k">as</span> <span class="n">vp2</span>
<span class="kn">from</span> <span class="nn">vampyr</span> <span class="kn">import</span> <span class="n">vampyr3d</span> <span class="k">as</span> <span class="n">vp3</span>
<span class="kn">from</span> <span class="nn">plotter</span> <span class="kn">import</span> <span class="n">grid_plotter</span>

<span class="n">MRA</span> <span class="o">=</span> <span class="n">vp3</span><span class="o">.</span><span class="n">MultiResolutionAnalysis</span><span class="p">(</span><span class="n">box</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">prec</span> <span class="o">=</span> <span class="mf">1.0e-3</span>
<span class="n">P_eps</span> <span class="o">=</span> <span class="n">vp3</span><span class="o">.</span><span class="n">ScalingProjector</span><span class="p">(</span><span class="n">MRA</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>

<span class="n">b</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="n">power</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">wideG</span> <span class="o">=</span> <span class="n">vp3</span><span class="o">.</span><span class="n">GaussFunc</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span>

<span class="n">b</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="n">power</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">narrowG</span> <span class="o">=</span> <span class="n">vp3</span><span class="o">.</span><span class="n">GaussFunc</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span>

<span class="n">wideG_tree</span> <span class="o">=</span> <span class="n">P_eps</span><span class="p">(</span><span class="n">wideG</span><span class="p">)</span>
<span class="n">narrowG_tree</span> <span class="o">=</span> <span class="n">P_eps</span><span class="p">(</span><span class="n">narrowG</span><span class="p">)</span>

<span class="n">sum_tree</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">wideG_tree</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">narrowG_tree</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">wideG_tree</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">narrowG_tree</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sum_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>*FunctionTree: nn
  genNodes: 0
  square norm: 0.0224484
  root scale: -4
  order: 5
  nodes: 680
  endNodes: 596
  nodes per scale: 
    scale=-4  nodes=8
    scale=-3  nodes=64
    scale=-2  nodes=96
    scale=-1  nodes=512


*FunctionTree: nn
  genNodes: 0
  square norm: 0.179587
  root scale: -4
  order: 5
  nodes: 520
  endNodes: 456
  nodes per scale: 
    scale=-4  nodes=8
    scale=-3  nodes=32
    scale=-2  nodes=32
    scale=-1  nodes=64
    scale=0  nodes=384


*FunctionTree: nn
  genNodes: 0
  square norm: 1.70608
  root scale: -4
  order: 5
  nodes: 1096
  endNodes: 960
  nodes per scale: 
    scale=-4  nodes=8
    scale=-3  nodes=64
    scale=-2  nodes=96
    scale=-1  nodes=544
    scale=0  nodes=384
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plotter</span> <span class="kn">import</span> <span class="n">grid_plotter</span>
<span class="n">grid_plotter</span><span class="p">(</span><span class="n">narrowG_tree</span><span class="p">)</span>
<span class="n">grid_plotter</span><span class="p">(</span><span class="n">wideG_tree</span><span class="p">)</span>
<span class="n">grid_plotter</span><span class="p">(</span><span class="n">sum_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 900x900 with 1 Axes&gt;, &lt;Axes3DSubplot:&gt;)
</pre></div>
</div>
<img alt="../../_images/c7c597163d17ff57a7425a64bb9963edb956e1bd090385a302fbe172902c653a.png" src="../../_images/c7c597163d17ff57a7425a64bb9963edb956e1bd090385a302fbe172902c653a.png" />
<img alt="../../_images/e45bda479baabd528df94e95509b52883dfe630a8d15d4f6bfca0b5e13e0a1b6.png" src="../../_images/e45bda479baabd528df94e95509b52883dfe630a8d15d4f6bfca0b5e13e0a1b6.png" />
<img alt="../../_images/784274b90a0d4bb4ad5c9e59496290410cf068428a026912650261081027427a.png" src="../../_images/784274b90a0d4bb4ad5c9e59496290410cf068428a026912650261081027427a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prod_tree</span> <span class="o">=</span> <span class="n">wideG_tree</span> <span class="o">*</span> <span class="n">narrowG_tree</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prod_tree</span><span class="p">)</span>
<span class="n">prod_tree</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="mf">0.1</span><span class="o">*</span><span class="n">prec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prod_tree</span><span class="p">)</span>
<span class="n">grid_plotter</span><span class="p">(</span><span class="n">prod_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>*FunctionTree: nn
  genNodes: 0
  square norm: 1.60958e-16
  root scale: -4
  order: 5
  nodes: 8776
  endNodes: 7680
  nodes per scale: 
    scale=-4  nodes=8
    scale=-3  nodes=64
    scale=-2  nodes=512
    scale=-1  nodes=768
    scale=0  nodes=4352
    scale=1  nodes=3072


*FunctionTree: nn
  genNodes: 0
  square norm: 1.60958e-16
  root scale: -4
  order: 5
  nodes: 296
  endNodes: 260
  nodes per scale: 
    scale=-4  nodes=8
    scale=-3  nodes=32
    scale=-2  nodes=32
    scale=-1  nodes=32
    scale=0  nodes=64
    scale=1  nodes=128
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 900x900 with 1 Axes&gt;, &lt;Axes3DSubplot:&gt;)
</pre></div>
</div>
<img alt="../../_images/ca6b86c73d25121d09fc6dde00ce03729817221b582bd1cad984fdbb0d5a8301.png" src="../../_images/ca6b86c73d25121d09fc6dde00ce03729817221b582bd1cad984fdbb0d5a8301.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">x_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1001</span><span class="p">)</span>
<span class="n">y1_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">narrowG_tree</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_vec</span> <span class="p">])</span>
<span class="n">y2_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wideG_tree</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_vec</span> <span class="p">])</span>
<span class="n">y3_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sum_tree</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_vec</span> <span class="p">])</span>
<span class="n">y4_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">prod_tree</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_vec</span> <span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vec</span><span class="p">,</span> <span class="n">y1_vec</span><span class="p">,</span> <span class="s2">&quot;tab:red&quot;</span><span class="p">)</span> <span class="c1"># potential from narrow Gaussian</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vec</span><span class="p">,</span> <span class="n">y2_vec</span><span class="p">,</span> <span class="s2">&quot;tab:blue&quot;</span><span class="p">)</span> <span class="c1"># potential from wide Gaussian</span>
<span class="c1">#plt.plot(x_vec, y3_vec, &quot;tab:green&quot;) # point charge potential</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vec</span><span class="p">,</span> <span class="mi">10000</span> <span class="o">*</span> <span class="n">y4_vec</span><span class="p">,</span> <span class="s2">&quot;tab:cyan&quot;</span><span class="p">)</span> <span class="c1"># point charge potential</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/19b5d8acda9d0facad06e36c790edf4babf841babc2154b43a397e5a3a21e4c2.png" src="../../_images/19b5d8acda9d0facad06e36c790edf4babf841babc2154b43a397e5a3a21e4c2.png" />
</div>
</div>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../Ex-10_derivatives/"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Derivative operators</p>
      </div>
    </a>
    <a class="right-next"
       href="../../zbibliography/"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Bibliography</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The contributors
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, The contributors.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>